<ng-keyboard-shortcuts *ngIf="shortcuts" [shortcuts]="shortcuts"></ng-keyboard-shortcuts>
<app-notification></app-notification>
<loader *ngIf="loader"></loader>

<div class="capture-header">
  <h1 class="capture-form-title text-dark">
    <span>{{attachmentLabel}}</span>
  </h1>
</div>
<br>

<form [formGroup]="form" (ngSubmit)="submit(form)" *ngIf="!loader">
  <div class="row">
    <div class="col-6">
      <mat-form-field appearance="fill" >
        <mat-label>
          MRN
        </mat-label>
        <input matInput type="text" formControlName="mrn" #startForm (focusin)="updateHelpContext('form-cusrelease-mrn')" />
        <button *ngIf="form.controls.mrnOBit.value" type="button"  matSuffix mat-icon-button (click)="undoOverride('mrn')" matTooltip="Remove Override"><mat-icon>clear</mat-icon></button>
        <mat-hint *ngIf="form.controls.mrnOBit.value">OVERRIDE: {{form.controls.lrnOReason.value}}</mat-hint>
        <button *ngIf="!form.controls.mrnOBit.value  && form.controls.mrn.errors?.incorrect" type="button"  matSuffix mat-icon-button (click)="overrideDialog('mrn', 'MRN')" matTooltip="Override"><mat-icon>remove_circle</mat-icon></button>
        <mat-error *ngIf="!form.controls.mrnOBit.value  && form.controls.mrn.errors?.incorrect">{{getError('mrn')}}</mat-error>
        <mat-error *ngIf="form.get('mrn').hasError('required')">This field is required</mat-error>
        <mat-error *ngIf="form.get('mrn').hasError('pattern')">Starts with 3 Letters, a valid Date (20201212) and is 18 characters long</mat-error>
      </mat-form-field>
      <br /><br />
    </div>
    <div class="col-6">
      <mat-form-field appearance="fill" >
        <mat-label>
          LRN
        </mat-label>
        <input matInput type="text" formControlName="lrn" (focusin)="updateHelpContext('form-cusrelease-lrn')"/>
        <button *ngIf="form.controls.lrnOBit.value" type="button"  matSuffix mat-icon-button (click)="undoOverride('lrn')" matTooltip="Remove Override"><mat-icon>clear</mat-icon></button>
        <mat-hint *ngIf="form.controls.lrnOBit.value">OVERRIDE: {{form.controls.lrnOReason.value}}</mat-hint>
        <button *ngIf="!form.controls.lrnOBit.value  && form.controls.lrn.errors?.incorrect" type="button"  matSuffix mat-icon-button (click)="overrideDialog('lrn', 'LRN')" matTooltip="Override"><mat-icon>remove_circle</mat-icon></button>
        <mat-error *ngIf="!form.controls.lrnOBit.value  && form.controls.lrn.errors?.incorrect">{{getError('lrn')}}</mat-error>
      </mat-form-field>
      <br /><br />
    </div>
    <div class="col-12">
      <mat-form-field appearance="fill" >
        <mat-label>
          Serial No
        </mat-label>
        <input matInput type="text" formControlName="serialNo" (focusin)="updateHelpContext('form-cusrelease-serialNo')"/>
        <button *ngIf="form.controls.serialNoOBit.value" type="button"  matSuffix mat-icon-button (click)="undoOverride('serialNo')" matTooltip="Remove Override"><mat-icon>clear</mat-icon></button>
        <mat-hint *ngIf="form.controls.serialNoOBit.value">OVERRIDE: {{form.controls.serialNoOReason.value}}</mat-hint>
        <button *ngIf="!form.controls.serialNoOBit.value  && form.controls.serialNo.errors?.incorrect" type="button"  matSuffix mat-icon-button (click)="overrideDialog('serialNo', 'Serial No')" matTooltip="Override"><mat-icon>remove_circle</mat-icon></button>
        <mat-error *ngIf="!form.controls.serialNoOBit.value  && form.controls.serialNo.errors?.incorrect">{{getError('serialNo')}}</mat-error>
      </mat-form-field>
      <br /><br />
    </div>
    <div class="col-12">
      <mat-form-field appearance="fill" >
        <mat-label>
          Importers Code
        </mat-label>
        <input matInput type="text" formControlName="importersCode" (focusin)="updateHelpContext('form-cusrelease-importersCode')"/>
        <button *ngIf="form.controls.importersCodeOBit.value" type="button"  matSuffix mat-icon-button (click)="undoOverride('importersCode')" matTooltip="Remove Override"><mat-icon>clear</mat-icon></button>
        <mat-hint *ngIf="form.controls.importersCodeOBit.value">OVERRIDE: {{form.controls.importersCodeOReason.value}}</mat-hint>
        <mat-icon *ngIf="!form.controls.importersCodeOBit.value && form.controls.importersCode.errors?.incorrect" matSuffix (click)="overrideDialog('importersCode', 'importersCode')" matTooltip="Override">remove_circle</mat-icon>
        <button *ngIf="!form.controls.importersCodeOBit.value  && form.controls.importersCode.errors?.incorrect" type="button"  matSuffix mat-icon-button (click)="overrideDialog('importersCode', 'Importers Code')" matTooltip="Override"><mat-icon>remove_circle</mat-icon></button>
        <mat-error *ngIf="!form.controls.importersCodeOBit.value  && form.controls.importersCode.errors?.incorrect">{{getError('importersCode')}}</mat-error>
      </mat-form-field>
      <br /><br />
    </div>
    <div class="col-12">
      <mat-form-field appearance="fill" >
        <mat-label>
          Waybill No
        </mat-label>
        <input matInput type="text" formControlName="waybillNo" (focusin)="updateHelpContext('form-cusrelease-waybillNo')" />
        <button *ngIf="form.controls.waybillNoOBit.value" type="button"  matSuffix mat-icon-button (click)="undoOverride('waybillNo')" matTooltip="Remove Override"><mat-icon>clear</mat-icon></button>
        <mat-hint *ngIf="form.controls.waybillNoOBit.value">OVERRIDE: {{form.controls.waybillNoOReason.value}}</mat-hint>
        <button *ngIf="!form.controls.waybillNoOBit.value  && form.controls.waybillNo.errors?.incorrect" type="button"  matSuffix mat-icon-button (click)="overrideDialog('waybillNo', 'Waybill No')" matTooltip="Override"><mat-icon>remove_circle</mat-icon></button>
        <mat-error *ngIf="!form.controls.waybillNoOBit.value  && form.controls.waybillNo.errors?.incorrect">{{getError('waybillNo')}}</mat-error>
      </mat-form-field>
      <br /><br />
    </div>
    <div class="col-4" >
      <ls-autocomplete-cpc [(control)]="form.controls.pccID" [helpSlug]="'form-crn-pcc'"></ls-autocomplete-cpc>
      <br /><br />
    </div>
    <div class="col-4">
      <mat-form-field appearance="fill" >
        <mat-label>
          Total Customs Value
        </mat-label>
        <input matInput type="text" formControlName="totalCustomsValue" (focusin)="updateHelpContext('form-cusrelease-total-customs-value')"/>
        <button *ngIf="form.controls.totalCustomsValueOBit.value" type="button"  matSuffix mat-icon-button (click)="undoOverride('totalCustomsValue')" matTooltip="Remove Override"><mat-icon>clear</mat-icon></button>
        <mat-hint *ngIf="form.controls.totalCustomsValueOBit.value">OVERRIDE: {{form.controls.totalCustomsValueOReason.value}}</mat-hint>
        <button *ngIf="!form.controls.totalCustomsValueOBit.value  && form.controls.totalCustomsValue.errors?.incorrect" type="button"  matSuffix mat-icon-button (click)="overrideDialog('totalCustomsValue', 'Total Customs Value')" matTooltip="Override"><mat-icon>remove_circle</mat-icon></button>
        <mat-error *ngIf="!form.controls.totalCustomsValueOBit.value  && form.controls.totalCustomsValue.errors?.incorrect">{{getError('totalCustomsValue')}}</mat-error>
      </mat-form-field>
      <br /><br />
    </div>
    <div class="col-4">
      <mat-form-field appearance="fill" >
        <mat-label>
          Total Duty
        </mat-label>
        <input matInput type="text" formControlName="totalDuty" (focusin)="updateHelpContext('form-cusrelease-total-duty')"/>
        <button *ngIf="form.controls.totalDutyOBit.value" type="button"  matSuffix mat-icon-button (click)="undoOverride('totalDuty')" matTooltip="Remove Override"><mat-icon>clear</mat-icon></button>
        <mat-hint *ngIf="form.controls.totalDutyOBit.value">OVERRIDE: {{form.controls.totalDutyOReason.value}}</mat-hint>
        <button *ngIf="!form.controls.totalDutyOBit.value  && form.controls.totalDuty.errors?.incorrect" type="button"  matSuffix mat-icon-button (click)="overrideDialog('totalDuty', 'Total Duty')" matTooltip="Override"><mat-icon>remove_circle</mat-icon></button>
        <mat-error *ngIf="!form.controls.totalDutyOBit.value  && form.controls.totalDuty.errors?.incorrect">{{getError('totalDuty')}}</mat-error>
      </mat-form-field>
      <br /><br />
    </div>
    <div class="col-12">
      <mat-form-field appearance="fill" >
        <mat-label>
          File Reference
        </mat-label>
        <input matInput type="text" formControlName="fileRef" (focusin)="updateHelpContext('form-cusrelease-file-ref')"/>
        <button *ngIf="form.controls.fileRefOBit.value" type="button"  matSuffix mat-icon-button (click)="undoOverride('fileRef')" matTooltip="Remove Override"><mat-icon>clear</mat-icon></button>
        <mat-hint *ngIf="form.controls.fileRefOBit.value">OVERRIDE: {{form.controls.fileRefOReason.value}}</mat-hint>
        <button *ngIf="!form.controls.fileRefOBit.value  && form.controls.fileRef.errors?.incorrect" type="button"  matSuffix mat-icon-button (click)="overrideDialog('fileRef', 'File Reference')" matTooltip="Override"><mat-icon>remove_circle</mat-icon></button>
        <mat-error *ngIf="!form.controls.fileRefOBit.value  && form.controls.fileRef.errors?.incorrect">{{getError('fileRef')}}</mat-error>
      </mat-form-field>
      <br /><br />
    </div>
    <div class="col-12" >
      <ls-autocomplete-edi-statuses
        [(control)]="form.controls.ediStatusID"
        [helpSlug]="'form-crn-edi-status'">
      </ls-autocomplete-edi-statuses>
      <br /><br />
    </div>
  </div>
</form>

<app-capture-errors [(errors)]="errors" [(open)]="showErrors"></app-capture-errors>
